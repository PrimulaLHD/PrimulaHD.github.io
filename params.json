{"name":"使用ggplot2画barplot","tagline":"Hai-Dong ","body":"# 计算均值、标准差、标准误、95%的置信区间的函数\r\n代码来自[**R Cookbook**](http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/)\r\n```{r}\r\n# the funtion summarySE() can return the mean, sd, se, and 95% ci of variable\r\nsummarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,\r\n        conf.interval=.95, .drop=TRUE) {\r\nlibrary(plyr)\r\n# New version of length which can handle NA's: if na.rm==T, don't count them\r\nlength2 <- function (x, na.rm=FALSE) {\r\n        if (na.rm) sum(!is.na(x))\r\n        else       length(x)\r\n}\r\n# This does the summary. For each group's data frame, return a vector with\r\n# N, mean, and sd\r\ndatac <- ddply(data, groupvars, .drop=.drop,\r\n.fun = function(xx, col) {\r\n        c(N    = length2(xx[[col]], na.rm=na.rm),\r\n        mean = mean   (xx[[col]], na.rm=na.rm),\r\n        sd   = sd     (xx[[col]], na.rm=na.rm)\r\n        )\r\n},\r\nmeasurevar\r\n)\r\n# Rename the \"mean\" column\r\ndatac <- rename(datac, c(\"mean\" = measurevar))\r\ndatac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean\r\n# Confidence interval multiplier for standard error\r\n# Calculate t-statistic for confidence interval:\r\n# e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1\r\nciMult <- qt(conf.interval/2 + .5, datac$N-1)\r\ndatac$ci <- datac$se * ciMult\r\nreturn(datac)\r\n}\r\n```\r\n#准备数据\r\n```{r}\r\nsetwd(\"D:/Dataset/Distyly_syndrom\")\r\nTraits <- read.csv(\"Traits.csv\") # read data\r\nCW_mean <- summarySE(Traits, measurevar=\"CW\", groupvars=c(\"Morph\",\"Species\")) # calculate mean and se/sd/ci using function\r\n```\r\n#用ggplot2画barplot\r\n```{r}\r\nlibrary(ggplot2)\r\npd <- position_dodge(0.1) # move them .05 to the left and right\r\nggplot(CW_mean, aes(x= Species, y=CW, fill=Morph)) +\r\ngeom_bar(position=position_dodge(.9), colour=\"black\",\r\n        stat=\"identity\") +\r\ngeom_errorbar(position=position_dodge(.9), width=.25,\r\n        aes(ymin=CW-sd, ymax=CW+sd)) +\r\ncoord_cartesian(ylim=c(0,30)) +\r\nscale_fill_manual(values=c(\"#CCCCCC\",\"#FFFFFF\")) +\r\ntheme_bw() +\r\ngeom_hline(yintercept=38)\r\n```\r\n输出图形如下：   \r\n![cw](D:/Dataset/Distyly_syndrom/cw.pdf)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}